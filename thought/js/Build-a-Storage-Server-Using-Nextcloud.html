<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 Nextcloud 搭建私人云盘 | Amoursun&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/img/logo.ico">
    <link rel="manifest" href="/blog/manifest.json">
    <meta name="description" content="作为技术博客, 文档, 技术整理">
    
    <link rel="preload" href="/blog/assets/css/0.styles.5aea80a1.css" as="style"><link rel="preload" href="/blog/assets/js/app.e0e544c6.js" as="script"><link rel="preload" href="/blog/assets/js/2.70d6758f.js" as="script"><link rel="preload" href="/blog/assets/js/3.d63df9ff.js" as="script"><link rel="preload" href="/blog/assets/js/31.423bc20b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d0d8e419.js"><link rel="prefetch" href="/blog/assets/js/11.5bd38ef6.js"><link rel="prefetch" href="/blog/assets/js/12.f4c5c49f.js"><link rel="prefetch" href="/blog/assets/js/13.ca1459b3.js"><link rel="prefetch" href="/blog/assets/js/14.43e0c178.js"><link rel="prefetch" href="/blog/assets/js/15.0da05c48.js"><link rel="prefetch" href="/blog/assets/js/16.62bc81fc.js"><link rel="prefetch" href="/blog/assets/js/17.032fff81.js"><link rel="prefetch" href="/blog/assets/js/18.a71d4de7.js"><link rel="prefetch" href="/blog/assets/js/19.12f74002.js"><link rel="prefetch" href="/blog/assets/js/20.e99b31a9.js"><link rel="prefetch" href="/blog/assets/js/21.49fd11b5.js"><link rel="prefetch" href="/blog/assets/js/22.003458f8.js"><link rel="prefetch" href="/blog/assets/js/23.526f8d49.js"><link rel="prefetch" href="/blog/assets/js/24.b4e824e1.js"><link rel="prefetch" href="/blog/assets/js/25.f9201e4f.js"><link rel="prefetch" href="/blog/assets/js/26.d1d2d509.js"><link rel="prefetch" href="/blog/assets/js/27.f4e90918.js"><link rel="prefetch" href="/blog/assets/js/28.2183adee.js"><link rel="prefetch" href="/blog/assets/js/29.f1904805.js"><link rel="prefetch" href="/blog/assets/js/30.55d8c058.js"><link rel="prefetch" href="/blog/assets/js/32.7615ffed.js"><link rel="prefetch" href="/blog/assets/js/33.e29da7d5.js"><link rel="prefetch" href="/blog/assets/js/34.4bfe6317.js"><link rel="prefetch" href="/blog/assets/js/35.b4b0ce1b.js"><link rel="prefetch" href="/blog/assets/js/36.8cb3bb91.js"><link rel="prefetch" href="/blog/assets/js/37.d66a3e13.js"><link rel="prefetch" href="/blog/assets/js/38.e70b182b.js"><link rel="prefetch" href="/blog/assets/js/39.f5b7d468.js"><link rel="prefetch" href="/blog/assets/js/4.080c088e.js"><link rel="prefetch" href="/blog/assets/js/40.1edc0645.js"><link rel="prefetch" href="/blog/assets/js/41.2f2c5f88.js"><link rel="prefetch" href="/blog/assets/js/42.43c220ea.js"><link rel="prefetch" href="/blog/assets/js/43.6ecc4db0.js"><link rel="prefetch" href="/blog/assets/js/44.1c8def69.js"><link rel="prefetch" href="/blog/assets/js/45.ef1f7a61.js"><link rel="prefetch" href="/blog/assets/js/46.3e685d61.js"><link rel="prefetch" href="/blog/assets/js/47.2aba3caa.js"><link rel="prefetch" href="/blog/assets/js/48.00bbbe64.js"><link rel="prefetch" href="/blog/assets/js/5.30a9c197.js"><link rel="prefetch" href="/blog/assets/js/6.eb55fb5c.js"><link rel="prefetch" href="/blog/assets/js/7.f6698711.js"><link rel="prefetch" href="/blog/assets/js/8.e03b7769.js"><link rel="prefetch" href="/blog/assets/js/9.03071b23.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5aea80a1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-9bbf9532><header class="navbar" data-v-9bbf9532><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Amoursun's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/blog/links/wiki/" class="nav-link">链接</a></div><div class="nav-item"><a href="/blog/FAQ/" class="nav-link">FAQ</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/thought/js/" class="nav-link router-link-active">JS</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/react&amp;mobx/" class="nav-link">React &amp; Mobx</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">作者</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/another/aboutSelf.html" class="nav-link">关于作者</a></li></ul></div></div> <a href="https://github.com/amoursun/blob.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-9bbf9532></div> <aside class="sidebar" data-v-9bbf9532><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/blog/links/wiki/" class="nav-link">链接</a></div><div class="nav-item"><a href="/blog/FAQ/" class="nav-link">FAQ</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/thought/js/" class="nav-link router-link-active">JS</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/react&amp;mobx/" class="nav-link">React &amp; Mobx</a></li><li class="dropdown-item"><!----> <a href="/blog/thought/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">作者</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/another/aboutSelf.html" class="nav-link">关于作者</a></li></ul></div></div> <a href="https://github.com/amoursun/blob.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS</span> <span class="arrow down"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React &amp; Mobx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page" data-v-9bbf9532> <div class="theme-default-content content__default"><h1 id="使用-nextcloud-搭建私人云盘"><a href="#使用-nextcloud-搭建私人云盘" class="header-anchor">#</a> 使用 Nextcloud 搭建私人云盘</h1> <p>先前很多次都有想过搭建一个私人的云盘，却又因为感觉没有必要的矛盾心理而放弃了。这一次终于有机会可以接触到这个步骤了！</p> <p>由于先前了解过这方面的内容，所以我一个想到了一个开源的应用程序——Nextcloud，大概可以理解为 OwnCloud 的升级版。</p> <p><img src="https://i.loli.net/2019/11/15/VE9OkwWLDlxPfQ6.jpg" alt=""></p> <p>最开始我还以为它是一个线上的云盘服务，后来发现它其实是一个能够自己部署的开源程序。大概可以理解为它直接给你提供了一个一站式的云盘服务，包括前端和后端，这样你就不需要再去自己写程序管理了！<em>其实大概类似于把百度云部署到了自己的服务器上的感觉（错乱）。</em></p> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <p>在开始搭建之前，你需要准备一些东西，大概有这么几种</p> <ul><li>一台完全被你掌握的 VPS
<ul><li>硬盘要够大！否则就失去了意义。</li> <li><strong>本文中使用 Ubuntu 18.04 进行演示，其它系统操作应该类似。</strong></li></ul></li> <li>Apache / Nginx、PHP <strong>&gt;=7.2</strong> 和 MySQL 支持
<ul><li>建议全部使用最新版本</li></ul></li></ul> <p>在满足了这些必须条件以后，就可以开始着手搭建了。</p> <h2 id="搭建"><a href="#搭建" class="header-anchor">#</a> 搭建</h2> <h3 id="准备工作-2"><a href="#准备工作-2" class="header-anchor">#</a> 准备工作</h3> <p>首先我们需要 Nextcloud 的软件包，也就是本体。网页在这里 <a href="https://nextcloud.com/install/#instructions-server" target="_blank" rel="noopener noreferrer">https://nextcloud.com/install/#instructions-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。不过其实你并不需要亲自去，在这里我们会跟随着步骤逐步引入。</p> <p>Nextcloud 安装有两种方式，一种是传统的软件包解压，另一种是使用官方发布的 <code>php</code> 文件按步骤一键安装。不过本文所探讨的仅限于前者，对于后者来说，笔者的服务器上并不能成功运行。考虑到国内部分特殊情况，我本人更倾向于前者。</p> <p>那么现在开始<strong>下载</strong>吧。点击<a href="https://download.nextcloud.com/server/releases/nextcloud-17.0.1.zip" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>打开 Nextcloud 17.0.1 的官网下载链接。<strong>该版本截至 2019 年 11 月 15 日为最新。</strong></p> <div class="custom-block warning"><p><strong>⚠️ Warning</strong></p> <p>Not friendly to mainland network.</p></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 为什么不用 curl 呢</span>
<span class="token function">curl</span> https://download.nextcloud.com/server/releases/nextcloud-17.0.1.zip -o nextcloud-17.0.1.zip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下载完毕后解压到要部署网站的位置。需要注意的是解压出来的并不是一大堆文件，而是一个 <code>nextcloud</code> 文件夹，里面包含的才是你想要的文件。因此如果你真的想要把它部署到某个目录，别忘了将 <code>nextcloud</code> 文件夹里的文件移动出来（<code>mv nextcloud/* &lt;document-root&gt;</code>）。</p> <div class="custom-block tip"><p><strong>提示 ❓</strong></p> <p>下文中使用 <code>&lt;document-root&gt;</code> 代替你所部署网页的位置，即所有网页文件的存放点和 Webserver 的根目录。</p></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 如果没有可以 sudo apt-get install unzip</span>
<span class="token function">unzip</span> nextcloud-17.0.1.zip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样一来准备工作就完成了。这个时候虽然你可以看到目录底下出现了 <code>index.php</code>，但是当你访问的时候你会发现事情并没有你想象的那么简单 🤔。</p> <h3 id="依赖和数据库"><a href="#依赖和数据库" class="header-anchor">#</a> 依赖和数据库</h3> <p>首先需要确保将 Webserver 的根目录设置为你所解压 Nextcloud 并包含其所有文件的地方，这一步应该不需要多提了。</p> <p>Nextcloud 所部署的环境应保证<strong>越新越好</strong>：</p> <ul><li>操作系统应使用较新的 LTS 发行版；</li> <li>PHP 必须满足 &gt;=7.1，但是强烈推荐 <strong>&gt;=7.2</strong></li> <li>MySQL 必须满足 &gt;=5.5，支持 MariaDB</li></ul> <p>确保上面的刚性条件具备了以后，我们需要给 php 安装拓展。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 这些都是必要的拓展。</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php7.2-gd php7.2-json php7.2-curl php7.2-mbstring php7.2-mysql php7.2-intl php-imagick php7.2-xml php7.2-zip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接下来，为了安装能够顺利进行，我们必须给予 Web 服务器目录的权限：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 如果是 nginx 那么这里的用户会有所不同。</span>
<span class="token function">sudo</span> <span class="token function">chown</span> -R www-data:www-data <span class="token operator">&lt;</span>document-root<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接下来设置数据库。为了方面，这里就不一一解释各个配置的含义。仅需将以下内容粘贴到 <code>/etc/mysql/my.cnf</code> 中即可。</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>[server]
skip-name-resolve
innodb_buffer_pool_size = 128M
innodb_buffer_pool_instances = 1
innodb_flush_log_at_trx_commit = 2
innodb_log_buffer_size = 32M
innodb_max_dirty_pages_pct = 90
query_cache_type = 1
query_cache_limit = 2M
query_cache_min_res_unit = 2k
query_cache_size = 64M
tmp_table_size= 64M
max_heap_table_size= 64M
slow-query-log = 1
slow-query-log-file = /var/log/mysql/slow.log
long_query_time = 1

[client-server]
!includedir /etc/mysql/conf.d/
!includedir /etc/mysql/mariadb.conf.d/

[client]
default-character-set = utf8mb4

[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_general_ci
transaction_isolation = READ-COMMITTED
binlog_format = ROW
innodb_large_prefix=on
innodb_file_format=barracuda
innodb_file_per_table=1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><div class="custom-block warning"><p><strong>注意内容分节</strong></p> <p>在编辑 <code>my.cnf</code> 的时候，预设情况下可能已经出现了 <code>[mysqld]</code> 等小结，这个时候就不要直接暴力粘贴，而是选择性的将那些原先没有的配置粘贴到相应的位置，没有的就直接全部复制。</p></div> <p>最后记得重启。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>接下来修改 PHP 的 mysql 拓展的配置。通常情况下这个配置文件应该处于 <code>/etc/php7/conf.d/mysql.ini</code>，但是也许是因为系统差异，笔者的配置文件处于 <code>/etc/php/7.2/apache2/conf.d/20-pdo_mysql.ini</code>。各位可以根据自己的实际情况结合上述内容判断该配置文件的位置。</p> <p>验证是否为所要更改的配置文件的依据是看开头是否有</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code># configuration for PHP MySQL module
extension=pdo_mysql.so
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接下来将如下内容粘贴</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>[mysql]
mysql.allow_local_infile=On
mysql.allow_persistent=On
mysql.cache_size=2000
mysql.max_persistent=-1
mysql.max_links=-1
mysql.default_port=
mysql.default_socket=/var/lib/mysql/mysql.sock  # Debian squeeze: /var/run/mysqld/mysqld.sock
mysql.default_host=
mysql.default_user=
mysql.default_password=
mysql.connect_timeout=60
mysql.trace_mode=Off
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>重启 Webserver，这里用的是 Apache。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart apache2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么数据库的配置工作就已经完成了！接下来我们创建 Nextcloud 所需要的数据库。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 进入数据库</span>

mysql -u root -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后我们先单独创建一个 Nextcloud 专用账号</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'nextcloud'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'密码'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再创建 Nextcloud 所需的数据库</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 在这里使用了 utf8mb4 编码以支持 Emoji 表情</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> nextcloud <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后给予我们之前创建的那个账户对此数据库的完全访问：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span><span class="token punctuation">,</span> <span class="token keyword">CREATE</span><span class="token punctuation">,</span> <span class="token keyword">DROP</span><span class="token punctuation">,</span> <span class="token keyword">INDEX</span><span class="token punctuation">,</span> <span class="token keyword">ALTER</span><span class="token punctuation">,</span> <span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLES</span> <span class="token keyword">ON</span> nextcloud<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'nextcloud'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'密码'</span><span class="token punctuation">;</span>
FLUSH <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后就可以退出了。</p> <h3 id="正式安装"><a href="#正式安装" class="header-anchor">#</a> 正式安装</h3> <p>没错！这才是正式安装的时刻。实际上只需要一行指令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>document-root<span class="token operator">&gt;</span>
<span class="token function">sudo</span> -u www-data php occ maintenance:install --database <span class="token string">&quot;mysql&quot;</span> --database-name <span class="token string">&quot;nextcloud&quot;</span> --database-user <span class="token string">&quot;nextcloud&quot;</span> --database-pass <span class="token string">&quot;密码&quot;</span> --admin-user <span class="token string">&quot;自定义&quot;</span> --admin-pass <span class="token string">&quot;自定义&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上述指令较容易出错，只要有一个参数有问题均会导致无法安装。其中标有自定义（密码）的地方代表需要你自己配置填写。</p> <p>如果最后显示</p> <div class="language-output line-numbers-mode"><pre class="language-text"><code>Nextcloud was successfully installed
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>代表安装成功了。这个时候打开你的网站，应该就可以看到正常页面了！</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于(Last Updated): </span> <span class="time">2021/10/6</span></div></footer> <!----> </main> <footer class="footer" data-v-0bd9fda2 data-v-9bbf9532><div class="copyright" data-v-0bd9fda2>© 2019~2021 Subilan's Blog</div> <div class="license" data-v-0bd9fda2>Powered by <a href="//vuepress.vuejs.org" data-v-0bd9fda2>VuePress</a></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.e0e544c6.js" defer></script><script src="/blog/assets/js/2.70d6758f.js" defer></script><script src="/blog/assets/js/3.d63df9ff.js" defer></script><script src="/blog/assets/js/31.423bc20b.js" defer></script>
  </body>
</html>
